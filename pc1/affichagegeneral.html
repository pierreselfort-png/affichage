<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Informations générales</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  background: #f4f6f8;
  color: #1f2937;
  font-family: Arial, Helvetica, sans-serif;
  height: 100vh;
}

/* ===== HEADER ===== */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 30px;
  background: #ffffff;
  border-bottom: 3px solid #e5e7eb;
}

.header img { height: 60px; }
.header .date { font-size: 22px; }

/* ===== MAIN ===== */
.main {
  height: calc(100vh - 160px);
  display: flex;
  justify-content: center;
  align-items: center;
}

.message-box {
  background: white;
  padding: 60px 80px;
  border-radius: 20px;
  box-shadow: 0 15px 35px rgba(0,0,0,0.12);
  max-width: 70%;
  text-align: center;
}

.message {
  font-size: 56px;
  line-height: 1.4;
  white-space: pre-line;
  transition: opacity .5s;
}

/* ===== FOOTER ===== */
.footer {
  position: fixed;
  bottom: 0;
  width: 100%;
  padding: 18px 30px;
  background: #ffffff;
  border-top: 3px solid #e5e7eb;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.time { font-size: 32px; font-weight: bold; }

.pc-select select {
  font-size: 18px;
  padding: 8px 12px;
  border-radius: 10px;
  border: 1px solid #cbd5e1;
}
</style>
</head>

<body>

<div class="header">
  <img src="https://seeklogo.com/images/T/trigano-logo-606375.png" alt="Trigano">
  <div class="date" id="date"></div>
</div>

<div class="main">
  <div class="message-box">
    <div class="message" id="message">Chargement…</div>
  </div>
</div>

<div class="footer">
  <div class="time" id="time"></div>
  <div class="pc-select">
    <select id="pcSelect"></select>
  </div>
</div>

<script>
/* ===== CONFIG ===== */
const SHEET_ID = "1rqtagt5yFWq7CCvMymb0ZPhnvoBoFc2KO3TChLhHmh0";
const SHEET_INDEX = 1;
const REFRESH_MS = 60000;

/* ===== CLOCK ===== */
function updateClock() {
  const now = new Date();
  time.textContent = now.toLocaleTimeString("fr-FR");
  date.textContent = now.toLocaleDateString("fr-FR", {
    weekday: "long", day: "2-digit", month: "long", year: "numeric"
  });
}
setInterval(updateClock, 1000);
updateClock();

/* ===== SHEET / CAROUSEL ===== */
const messageEl = document.getElementById("message");
const pcSelect = document.getElementById("pcSelect");

let rows = [];
let messages = [];
let msgIndex = 0;
let delaySec = 15;
let carouselTimer = null;

async function loadSheet() {
  const selectedId = pcSelect.value;

  const url = `https://opensheet.elk.sh/${SHEET_ID}/${SHEET_INDEX}`;
  const r = await fetch(url, { cache: "no-store" });
  rows = await r.json();

  pcSelect.innerHTML = "";
  rows.forEach(r => {
    const opt = document.createElement("option");
    opt.value = r.id;
    opt.textContent = r.titre || r.id;
    pcSelect.appendChild(opt);
  });

  if (rows.some(r => r.id === selectedId)) {
    pcSelect.value = selectedId;
  }

  updateCarousel();
}

function updateCarousel() {
  const row = rows.find(r => r.id === pcSelect.value);
  if (!row) return;

  messages = [row.msg1, row.msg2, row.msg3].filter(m => m && m.trim());
  delaySec = parseInt(row.delay) || 15;
  msgIndex = 0;

  if (carouselTimer) clearInterval(carouselTimer);

  showMessage();
  carouselTimer = setInterval(nextMessage, delaySec * 1000);
}

function showMessage() {
  messageEl.style.opacity = 0;
  setTimeout(() => {
    messageEl.textContent = messages[msgIndex] || "—";
    messageEl.style.opacity = 1;
  }, 300);
}

function nextMessage() {
  if (messages.length <= 1) return;
  msgIndex = (msgIndex + 1) % messages.length;
  showMessage();
}

pcSelect.addEventListener("change", updateCarousel);

/* INIT */
loadSheet();
setInterval(loadSheet, REFRESH_MS);
</script>

</body>
</html>
