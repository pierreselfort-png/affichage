<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Pilotage écrans</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: Arial, sans-serif;
  background: #0b0f14;
  color: white;
  padding: 40px;
}
.card {
  max-width: 700px;
  margin: auto;
  background: #111827;
  padding: 30px;
  border-radius: 12px;
}
label {
  display: block;
  margin-top: 15px;
}
select, textarea, input, button {
  width: 100%;
  margin-top: 6px;
  padding: 10px;
  font-size: 16px;
}
button {
  margin-top: 20px;
  background: #2563eb;
  border: none;
  color: white;
  cursor: pointer;
}
.status {
  margin-top: 15px;
  opacity: 0.8;
}
hr {
  margin: 30px 0;
  border: 1px solid #222;
}
</style>
</head>

<body>

<div class="card">
  <h2>Interface Chef d’atelier</h2>

  <!-- ===== SELECTION PC ===== -->
  <label>Écran</label>
  <select id="screen"></select>

  <label>Message</label>
  <textarea id="message" rows="4"></textarea>

  <button onclick="updateMessage()">Envoyer le message</button>

  <div class="status" id="status"></div>

  <hr>

  <!-- ===== AJOUT PC ===== -->
  <h3>Ajouter un nouvel écran</h3>

  <label>ID du PC (ex: pc3)</label>
  <input id="newId">

  <label>Titre</label>
  <input id="newTitle">

  <button onclick="addPC()">Ajouter le PC</button>
</div>

<script>
const API_URL = "COLLE_ICI_TON_URL_APPS_SCRIPT";

const screenSelect = document.getElementById("screen");
const messageInput = document.getElementById("message");
const status = document.getElementById("status");

/* ===== CHARGER LA LISTE DES PC ===== */
async function loadScreens() {
  const r = await fetch(API_URL);
  const data = await r.json();

  screenSelect.innerHTML = "";
  data.forEach(row => {
    const opt = document.createElement("option");
    opt.value = row.id;
    opt.textContent = row.titre || row.id;
    screenSelect.appendChild(opt);
  });

  loadMessage();
}

/* ===== CHARGER MESSAGE ===== */
async function loadMessage() {
  const id = screenSelect.value;
  const r = await fetch(API_URL);
  const data = await r.json();
  const row = data.find(r => r.id === id);
  messageInput.value = row ? row.message : "";
}

/* ===== UPDATE MESSAGE ===== */
async function updateMessage() {
  const id = screenSelect.value;
  const message = messageInput.value;

  status.textContent = "Envoi…";

  const r = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "update",
      id,
      message
    })
  });

  status.textContent = await r.text();
}

/* ===== AJOUT PC ===== */
async function addPC() {
  const id = document.getElementById("newId").value.trim();
  const titre = document.getElementById("newTitle").value.trim();

  if (!id) {
    status.textContent = "ID obligatoire";
    return;
  }

  const r = await fetc

