<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Admin – Pilotage écrans</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  background: #0b0f14;
  color: #ffffff;
  padding: 40px;
}

.card {
  max-width: 900px;
  margin: auto;
  background: #111827;
  padding: 30px;
  border-radius: 14px;
}

h2, h3 { margin-top: 0; }

label {
  display: block;
  margin-top: 14px;
  font-size: 14px;
  opacity: .85;
}

input, textarea, select, button {
  width: 100%;
  margin-top: 6px;
  padding: 10px;
  font-size: 16px;
  background: #020617;
  color: white;
  border: 1px solid #333;
  border-radius: 8px;
  box-sizing: border-box;
}

textarea { resize: vertical; }

.row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.btn {
  margin-top: 18px;
  padding: 12px;
  background: #2563eb;
  border: none;
  cursor: pointer;
  font-weight: bold;
}

.btn.secondary {
  background: #1f2937;
}

.status {
  margin-top: 14px;
  padding: 10px;
  background: rgba(255,255,255,0.05);
  border-radius: 8px;
  white-space: pre-line;
}

hr {
  margin: 30px 0;
  border: none;
  border-top: 1px solid rgba(255,255,255,0.15);
}
</style>
</head>

<body>

<div class="card">
  <h2>Interface Admin – Écrans</h2>
  <p style="opacity:.7">
    Modification des messages (carrousel) et du délai d’affichage.
  </p>

  <!-- ===== MODIFIER ===== -->
  <h3>Modifier un écran</h3>

  <label>Écran</label>
  <select id="pcSelect"></select>

  <div class="row">
    <div>
      <label>Titre</label>
      <input id="titre" disabled>
    </div>
    <div>
      <label>Emplacement</label>
      <input id="emplacement">
    </div>
  </div>

  <label>Message 1</label>
  <textarea id="msg1" rows="2"></textarea>

  <label>Message 2</label>
  <textarea id="msg2" rows="2"></textarea>

  <label>Message 3</label>
  <textarea id="msg3" rows="2"></textarea>

  <label>Délai (secondes)</label>
  <input type="number" id="delay" min="1">

  <button class="btn" onclick="save()">Enregistrer</button>
  <button class="btn secondary" onclick="reload()">Recharger</button>

  <div class="status" id="status"></div>

  <hr>

  <!-- ===== AJOUT ===== -->
  <h3>Ajouter un écran</h3>

  <div class="row">
    <div>
      <label>ID (unique)</label>
      <input id="newId" placeholder="pc6">
    </div>
    <div>
      <label>Titre</label>
      <input id="newTitle" placeholder="PC 6">
    </div>
  </div>

  <label>Emplacement</label>
  <input id="newEmplacement">

  <label>Message 1</label>
  <input id="newMsg1">

  <label>Délai (secondes)</label>
  <input type="number" id="newDelay" value="15">

  <button class="btn" onclick="add()">Ajouter l’écran</button>

  <div class="status" id="statusAdd"></div>
</div>

<script>
/* ================= CONFIG ================= */
const API_URL = "COLLE_ICI_TON_URL_APPS_SCRIPT";
/* ========================================== */

const pcSelect = document.getElementById("pcSelect");
const status = document.getElementById("status");
const statusAdd = document.getElementById("statusAdd");

let rows = [];

/* ===== LOAD ===== */
async function reload() {
  status.textContent = "Chargement…";
  const r = await fetch(API_URL, { cache: "no-store" });
  rows = await r.json();

  pcSelect.innerHTML = "";
  rows.forEach(r => {
    const o = document.createElement("option");
    o.value = r.id;
    o.textContent = r.titre || r.id;
    pcSelect.appendChild(o);
  });

  if (rows.length) {
    pcSelect.value = rows[0].id;
    fillForm();
  }

  status.textContent = "Chargé ✔";
}

function fillForm() {
  const r = rows.find(x => x.id === pcSelect.value);
  if (!r) return;

  titre.value = r.titre || "";
  emplacement.value = r.emplacement || "";
  msg1.value = r.msg1 || "";
  msg2.value = r.msg2 || "";
  msg3.value = r.msg3 || "";
  delay.value = r.delay || 15;
}

/* ===== SAVE ===== */
async function save() {
  const id = pcSelect.value;

  const payload = {
    action: "update",
    id,
    emplacement: emplacement.value,
    msg1: msg1.value,
    msg2: msg2.value,
    msg3: msg3.value,
    delay: delay.value
  };

  const r = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  });

  status.textContent = await r.text();
}

/* ===== ADD ===== */
async function add() {
  const payload = {
    action: "add",
    id: newId.value.trim(),
    titre: newTitle.value,
    emplacement: newEmplacement.value,
    msg1: newMsg1.value,
    msg2: "",
    msg3: "",
    delay: newDelay.value || 15
  };

  const r = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  });

  statusAdd.textContent = await r.text();
  reload();
}

pcSelect.addEventListener("change", fillForm);

/* INIT */
reload();
</script>

</body>
</html>
